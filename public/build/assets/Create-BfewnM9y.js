import{x as A,i as B,h as R,o as n,w as _,a as l,b as o,u as r,g as D,S as h,e as k,d as I,j as y,c as i,F as b,p as v,t as c,G as C,H as w}from"./app-B3--_BYh.js";import{_ as N}from"./AppLayout-DuKiVIcH.js";import{P as T}from"./PageFooter-CCNwdcBR.js";import{_ as p}from"./InputError-eJiDf7Ac.js";import{_ as q}from"./InputLabel-g7xb6lBe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"flex flex-col min-h-screen"},P={class:"flex-1"},j={class:"mb-6"},E={class:"flex items-center gap-4"},L={class:"card rounded-lg shadow-sm p-6"},G=["value"],H={class:"overflow-x-auto"},O={class:"w-full border"},z={class:"px-4 py-2"},J=["onUpdate:modelValue"],K=["value"],Q={class:"px-4 py-2 text-sm"},W={key:0},X={key:1},Y={class:"px-4 py-2"},Z=["onUpdate:modelValue"],oo={class:"px-4 py-2"},to=["onUpdate:modelValue"],eo={class:"px-4 py-2 font-medium"},so={class:"px-4 py-2"},ro=["onClick","disabled"],ao={class:"bg-gray-50 font-bold"},lo={class:"px-4 py-3"},no={class:"flex items-center gap-4 pt-4"},io=["disabled"],bo={__name:"Create",props:{proveedores:Array,insumos:Array,visitCount:Number},setup(m){const V=m,s=A({proveedor_id:"",detalles:[{insumo_id:"",cantidad:"",costo_unitario:""}]}),F=B(()=>s.detalles.reduce((d,t)=>{const e=parseFloat(t.cantidad)||0,u=parseFloat(t.costo_unitario)||0;return d+e*u},0).toFixed(2));function S(){s.detalles.push({insumo_id:"",cantidad:"",costo_unitario:""})}function U(d){s.detalles.length>1&&s.detalles.splice(d,1)}function x(d){return V.insumos.find(e=>e.id===parseInt(d))||null}function $(){s.post(route("restaurant.compras.store"))}return(d,t)=>(n(),R(N,null,{default:_(()=>[l(r(D),{title:"Registrar Compra - Restaurante"}),o("div",M,[o("div",P,[o("div",j,[o("div",E,[l(r(h),{href:d.route("restaurant.compras.index"),class:"text-2xl hover:opacity-75"},{default:_(()=>t[1]||(t[1]=[k("â†")])),_:1},8,["href"]),t[2]||(t[2]=o("div",null,[o("h1",{class:"text-3xl font-bold",style:{color:"var(--color-text-primary)"}},"Registrar Compra"),o("p",{class:"text-sm mt-1",style:{color:"var(--color-text-secondary)"}},"Registra una nueva compra de insumos")],-1))])]),o("div",L,[o("form",{onSubmit:I($,["prevent"]),class:"space-y-6"},[o("div",null,[l(q,{for:"proveedor_id",value:"Proveedor (opcional)"}),y(o("select",{id:"proveedor_id","onUpdate:modelValue":t[0]||(t[0]=e=>r(s).proveedor_id=e),class:"mt-1 block w-full px-4 py-2 rounded-lg border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"}},[t[3]||(t[3]=o("option",{value:""},"Sin proveedor",-1)),(n(!0),i(b,null,v(m.proveedores,e=>(n(),i("option",{key:e.id,value:e.id},c(e.nombre),9,G))),128))],512),[[C,r(s).proveedor_id]]),l(p,{class:"mt-2",message:r(s).errors.proveedor_id},null,8,["message"])]),o("div",null,[o("div",{class:"flex justify-between items-center mb-4"},[t[4]||(t[4]=o("h3",{class:"text-lg font-semibold",style:{color:"var(--color-text-primary)"}},"Detalles de la Compra",-1)),o("button",{type:"button",onClick:S,class:"btn-primary px-4 py-2 rounded-lg text-sm"}," + Agregar Insumo ")]),o("div",H,[o("table",O,[t[8]||(t[8]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"px-4 py-2 text-left"},"Insumo *"),o("th",{class:"px-4 py-2 text-left"},"Stock Actual"),o("th",{class:"px-4 py-2 text-left"},"Cantidad *"),o("th",{class:"px-4 py-2 text-left"},"Costo Unitario *"),o("th",{class:"px-4 py-2 text-left"},"Subtotal"),o("th",{class:"px-4 py-2 text-left"},"Acciones")])],-1)),o("tbody",null,[(n(!0),i(b,null,v(r(s).detalles,(e,u)=>{var f,g;return n(),i("tr",{key:u,class:"border-t"},[o("td",z,[y(o("select",{"onUpdate:modelValue":a=>e.insumo_id=a,class:"w-full px-2 py-1 rounded border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"},required:""},[t[5]||(t[5]=o("option",{value:""},"Seleccione...",-1)),(n(!0),i(b,null,v(m.insumos,a=>(n(),i("option",{key:a.id,value:a.id},c(a.nombre)+" "+c(a.marca?"("+a.marca.nombre+")":""),9,K))),128))],8,J),[[C,e.insumo_id]]),l(p,{class:"mt-1",message:r(s).errors[`detalles.${u}.insumo_id`]},null,8,["message"])]),o("td",Q,[e.insumo_id?(n(),i("span",W,c(((f=x(e.insumo_id))==null?void 0:f.stock)||0)+" "+c(((g=x(e.insumo_id))==null?void 0:g.unidad_medida)||""),1)):(n(),i("span",X,"-"))]),o("td",Y,[y(o("input",{"onUpdate:modelValue":a=>e.cantidad=a,type:"number",step:"0.01",min:"0.01",class:"w-full px-2 py-1 rounded border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"},required:""},null,8,Z),[[w,e.cantidad]]),l(p,{class:"mt-1",message:r(s).errors[`detalles.${u}.cantidad`]},null,8,["message"])]),o("td",oo,[y(o("input",{"onUpdate:modelValue":a=>e.costo_unitario=a,type:"number",step:"0.01",min:"0",class:"w-full px-2 py-1 rounded border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"},required:""},null,8,to),[[w,e.costo_unitario]]),l(p,{class:"mt-1",message:r(s).errors[`detalles.${u}.costo_unitario`]},null,8,["message"])]),o("td",eo," Bs. "+c(((parseFloat(e.cantidad)||0)*(parseFloat(e.costo_unitario)||0)).toFixed(2)),1),o("td",so,[o("button",{type:"button",onClick:a=>U(u),disabled:r(s).detalles.length===1,class:"text-red-600 hover:text-red-800 disabled:opacity-50 disabled:cursor-not-allowed"}," Eliminar ",8,ro)])])}),128))]),o("tfoot",null,[o("tr",ao,[t[6]||(t[6]=o("td",{colspan:"4",class:"px-4 py-3 text-right"},"TOTAL:",-1)),o("td",lo,"Bs. "+c(F.value),1),t[7]||(t[7]=o("td",null,null,-1))])])])]),l(p,{class:"mt-2",message:r(s).errors.detalles},null,8,["message"])]),o("div",no,[o("button",{type:"submit",class:"btn-primary px-6 py-2 rounded-lg font-medium transition",disabled:r(s).processing},c(r(s).processing?"Registrando...":"Registrar Compra"),9,io),l(r(h),{href:d.route("restaurant.compras.index"),class:"px-6 py-2 rounded-lg font-medium transition",style:{"background-color":"var(--color-border)",color:"var(--color-text-primary)"}},{default:_(()=>t[9]||(t[9]=[k(" Cancelar ")])),_:1},8,["href"])])],32)])]),l(T,{visitCount:m.visitCount},null,8,["visitCount"])])]),_:1}))}};export{bo as default};
