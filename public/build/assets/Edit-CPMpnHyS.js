import{x as B,i as N,h as z,o as n,w as g,a as d,b as o,u as a,g as D,S as $,e as h,t as c,d as M,j as x,c as u,F as k,p as C,G as V,n as A,f as T,H as E}from"./app-WIpr5u10.js";import{_ as q}from"./AppLayout-D8U70Zno.js";import{P as R}from"./PageFooter-CFCpgnrU.js";import{_ as f}from"./InputError-DqZBcfNI.js";import{_ as j}from"./InputLabel-Cn-mf5My.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"flex flex-col min-h-screen"},H={class:"flex-1"},L={class:"mb-6"},O={class:"flex items-center gap-4"},G={class:"text-3xl font-bold",style:{color:"var(--color-text-primary)"}},J={class:"card rounded-lg shadow-sm p-6"},K=["value"],Q={class:"overflow-x-auto"},W={class:"w-full border"},X={class:"px-4 py-2"},Y=["onUpdate:modelValue"],Z=["value"],oo={class:"px-4 py-2 text-sm"},to={key:0},eo={key:1},so={class:"px-4 py-2"},ro=["onUpdate:modelValue"],ao={class:"px-4 py-2"},lo=["onUpdate:modelValue"],io={class:"px-4 py-2 font-medium"},no={class:"px-4 py-2"},co=["onClick"],uo={class:"bg-gray-50 font-bold"},mo={class:"px-4 py-3"},po={class:"flex items-center gap-4 pt-4"},fo=["disabled"],ho={__name:"Edit",props:{compra:Object,proveedores:Array,insumos:Array,visitCount:Number},setup(m){const _=m,r=B({proveedor_id:_.compra.proveedor_id||"",detalles:_.compra.detalles.map(s=>({id:s.id,insumo_id:s.insumo_id,cantidad:s.cantidad,costo_unitario:s.costo_unitario,cantidad_original:s.cantidad}))}),F=N(()=>r.detalles.reduce((s,t)=>{const e=parseFloat(t.cantidad)||0,i=parseFloat(t.costo_unitario)||0;return s+e*i},0).toFixed(2));function S(){r.detalles.push({insumo_id:"",cantidad:"",costo_unitario:""})}function I(s){const t=r.detalles[s];if(t.id){const e=p(t.insumo_id);if(e&&e.stock<t.cantidad&&!confirm(`ADVERTENCIA: El stock actual del insumo "${e.nombre}" (${e.stock} ${e.unidad_medida}) es menor a la cantidad de este detalle (${t.cantidad}). No se podrá eliminar. ¿Continuar de todos modos?`))return}r.detalles.splice(s,1)}function p(s){return _.insumos.find(e=>e.id===parseInt(s))||null}function y(s){if(!s.id||!s.cantidad_original)return 0;const t=parseFloat(s.cantidad_original)-parseFloat(s.cantidad||0);return t>0?t:0}function b(s){if(!s.id)return!1;const t=y(s);if(t<=0)return!1;const e=p(s.insumo_id);return e&&e.stock<t}function U(){let s=!1;r.detalles.forEach((t,e)=>{if(b(t)){const i=p(t.insumo_id),v=y(t);alert(`Error en detalle ${e+1}: Stock insuficiente del insumo "${i.nombre}". Stock actual: ${i.stock}, necesario: ${v}`),s=!0}}),!s&&r.put(route("restaurant.compras.update",_.compra.id))}return(s,t)=>(n(),z(q,null,{default:g(()=>[d(a(D),{title:"Editar Compra - Restaurante"}),o("div",P,[o("div",H,[o("div",L,[o("div",O,[d(a($),{href:s.route("restaurant.compras.index"),class:"text-2xl hover:opacity-75"},{default:g(()=>t[1]||(t[1]=[h("←")])),_:1},8,["href"]),o("div",null,[o("h1",G,"Editar Compra #"+c(m.compra.id),1),t[2]||(t[2]=o("p",{class:"text-sm mt-1",style:{color:"var(--color-text-secondary)"}},"Modifica los detalles de la compra",-1))])])]),t[10]||(t[10]=o("div",{class:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6"},[o("div",{class:"flex"},[o("div",{class:"flex-shrink-0"},[o("svg",{class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},[o("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),o("div",{class:"ml-3"},[o("p",{class:"text-sm text-yellow-700"},[o("strong",null,"Importante:"),h(" Al reducir cantidades o eliminar detalles, se validará que el stock actual del insumo lo permita. ")])])])],-1)),o("div",J,[o("form",{onSubmit:M(U,["prevent"]),class:"space-y-6"},[o("div",null,[d(j,{for:"proveedor_id",value:"Proveedor (opcional)"}),x(o("select",{id:"proveedor_id","onUpdate:modelValue":t[0]||(t[0]=e=>a(r).proveedor_id=e),class:"mt-1 block w-full px-4 py-2 rounded-lg border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"}},[t[3]||(t[3]=o("option",{value:""},"Sin proveedor",-1)),(n(!0),u(k,null,C(m.proveedores,e=>(n(),u("option",{key:e.id,value:e.id},c(e.nombre),9,K))),128))],512),[[V,a(r).proveedor_id]]),d(f,{class:"mt-2",message:a(r).errors.proveedor_id},null,8,["message"])]),o("div",null,[o("div",{class:"flex justify-between items-center mb-4"},[t[4]||(t[4]=o("h3",{class:"text-lg font-semibold",style:{color:"var(--color-text-primary)"}},"Detalles de la Compra",-1)),o("button",{type:"button",onClick:S,class:"btn-primary px-4 py-2 rounded-lg text-sm"}," + Agregar Insumo ")]),o("div",Q,[o("table",W,[t[8]||(t[8]=o("thead",null,[o("tr",{class:"bg-gray-100"},[o("th",{class:"px-4 py-2 text-left"},"Insumo *"),o("th",{class:"px-4 py-2 text-left"},"Stock Actual"),o("th",{class:"px-4 py-2 text-left"},"Cantidad *"),o("th",{class:"px-4 py-2 text-left"},"Costo Unit. *"),o("th",{class:"px-4 py-2 text-left"},"Subtotal"),o("th",{class:"px-4 py-2 text-left"},"Acciones")])],-1)),o("tbody",null,[(n(!0),u(k,null,C(a(r).detalles,(e,i)=>{var v,w;return n(),u("tr",{key:i,class:A(["border-t",{"bg-red-50":b(e)}])},[o("td",X,[x(o("select",{"onUpdate:modelValue":l=>e.insumo_id=l,class:"w-full px-2 py-1 rounded border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"},required:""},[t[5]||(t[5]=o("option",{value:""},"Seleccione...",-1)),(n(!0),u(k,null,C(m.insumos,l=>(n(),u("option",{key:l.id,value:l.id},c(l.nombre)+" "+c(l.marca?"("+l.marca.nombre+")":""),9,Z))),128))],8,Y),[[V,e.insumo_id]]),d(f,{class:"mt-1",message:a(r).errors[`detalles.${i}.insumo_id`]},null,8,["message"])]),o("td",oo,[e.insumo_id?(n(),u("span",to,c(((v=p(e.insumo_id))==null?void 0:v.stock)||0)+" "+c(((w=p(e.insumo_id))==null?void 0:w.unidad_medida)||""),1)):(n(),u("span",eo,"-"))]),o("td",so,[x(o("input",{"onUpdate:modelValue":l=>e.cantidad=l,type:"number",step:"0.01",min:"0.01",class:"w-full px-2 py-1 rounded border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"},required:""},null,8,ro),[[E,e.cantidad]]),d(f,{class:"mt-1",message:a(r).errors[`detalles.${i}.cantidad`]},null,8,["message"]),y(e)>0?(n(),u("div",{key:0,class:A(["text-xs mt-1",b(e)?"text-red-600":"text-yellow-600"])}," ⚠️ Reducción: "+c(y(e)),3)):T("",!0)]),o("td",ao,[x(o("input",{"onUpdate:modelValue":l=>e.costo_unitario=l,type:"number",step:"0.01",min:"0",class:"w-full px-2 py-1 rounded border",style:{"background-color":"var(--color-bg-secondary)","border-color":"var(--color-border)",color:"var(--color-text-primary)"},required:""},null,8,lo),[[E,e.costo_unitario]]),d(f,{class:"mt-1",message:a(r).errors[`detalles.${i}.costo_unitario`]},null,8,["message"])]),o("td",io," Bs. "+c(((parseFloat(e.cantidad)||0)*(parseFloat(e.costo_unitario)||0)).toFixed(2)),1),o("td",no,[o("button",{type:"button",onClick:l=>I(i),class:"text-red-600 hover:text-red-800"}," Eliminar ",8,co)])],2)}),128))]),o("tfoot",null,[o("tr",uo,[t[6]||(t[6]=o("td",{colspan:"4",class:"px-4 py-3 text-right"},"TOTAL:",-1)),o("td",mo,"Bs. "+c(F.value),1),t[7]||(t[7]=o("td",null,null,-1))])])])]),d(f,{class:"mt-2",message:a(r).errors.detalles},null,8,["message"])]),o("div",po,[o("button",{type:"submit",class:"btn-primary px-6 py-2 rounded-lg font-medium transition",disabled:a(r).processing},c(a(r).processing?"Actualizando...":"Actualizar Compra"),9,fo),d(a($),{href:s.route("restaurant.compras.index"),class:"px-6 py-2 rounded-lg font-medium transition",style:{"background-color":"var(--color-border)",color:"var(--color-text-primary)"}},{default:g(()=>t[9]||(t[9]=[h(" Cancelar ")])),_:1},8,["href"])])],32)])]),d(R,{visitCount:m.visitCount},null,8,["visitCount"])])]),_:1}))}};export{ho as default};
